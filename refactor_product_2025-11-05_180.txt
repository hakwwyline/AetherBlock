Refactor product search for rollback (low-priority)
